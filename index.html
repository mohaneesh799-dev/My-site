<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Romantic Journey</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=3.0">
</head>
<body>

    <div class="background-heart"></div> 

    <div id="dark-room">
        <div id="lamp-container">
            <div id="lamp-wire"></div>
            <div id="lamp-handle" class="glowing-heart"></div>
        </div>
        <p class="instruction">Pull the heart to begin...</p>
    </div>

    <div id="particle-container"></div>

    <audio id="bg-music" loop preload="auto">
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="pencil-trigger" onclick="checkPassword()">üëª</div>

    <section id="start-page" class="panel active start-bg">
        <div class="content-box">
            <h1 class="cursive">Welcome My Queen...</h1>
            <p>Click here to see inside.</p>
            <div class="nav-links">
                <button class="start-btn" onclick="startJourney()">Click</button>
            </div>
        </div>
    </section>

    <section id="int1" class="panel bg-1">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int2')">Next ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int2" class="panel bg-2">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int1')">‚Üê Back</button>
                <button onclick="nextPage('int3')">Continue ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int3" class="panel bg-3">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int2')">‚Üê Back</button>
                <button onclick="nextPage('int4')">Final page ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int4" class="panel bg-4">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int3')">‚Üê Back</button>
                <button onclick="nextPage('start-page')">Go back to start page</button>
            </div>
        </div>
    </section>

    <div id="secret-page" class="panel">
        <img src="panda.jpg" class="bg-panda-pic" alt="Panda">

        <div class="content-box">
            <h1 class="cursive" style="margin-top: 0; font-size: 3.5rem; text-shadow: 0 0 10px rgba(255,192,203,0.8);">
                For Your Eyes Only
            </h1>

            <div id="secret-letter-text" style="color: #ffffff !important; text-shadow: 1px 1px 5px rgba(0,0,0,0.5); min-height: 150px;">
            </div>

            <button onclick="resetToLamp()" class="glow-btn" style="margin-bottom: 0;">
                Back to Start
            </button>
        </div>
    </div>



    <script>
    const music = document.getElementById('bg-music');
    const particleContainer = document.getElementById('particle-container');
    const darkRoom = document.getElementById('dark-room');
    const handle = document.getElementById('lamp-handle');
    const wire = document.getElementById('lamp-wire');

    let isDragging = false;
    let startY = 0;
    let isSecretMode = false; 

   const startDrag = (e) => {
        isDragging = true;
        startY = e.touches ? e.touches[0].clientY : e.clientY;
        
        // FIX: Instead of play/pause (which glitches), 
        // we "prime" the audio by interacting with it once.
        music.play().then(() => {
            // If it plays, we keep it running but silent until reveal
            music.volume = 0; 
        }).catch(() => { console.log("Waiting for drag to complete..."); });
    };

    const onDrag = (e) => {
        if (!isDragging) return;
        const currentY = e.touches ? e.touches[0].clientY : e.clientY;
        const delta = Math.max(0, currentY - startY);
        if (delta < 250) {
            handle.style.transform = `translateY(${delta}px) rotate(-45deg)`;
            wire.style.height = (200 + delta) + "px";
        }
        if (delta > 160) {
            isDragging = false;
            revealSite();
        }
    };

    const stopDrag = () => {
        if (!isDragging) return;
        isDragging = false;
        handle.style.transition = "0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
        wire.style.transition = "0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
        handle.style.transform = "translateY(0) rotate(-45deg)";
        wire.style.height = "200px";
    };

    handle.addEventListener('mousedown', startDrag);
    handle.addEventListener('touchstart', startDrag, {passive: false});
    window.addEventListener('mousemove', onDrag);
    window.addEventListener('touchmove', onDrag, {passive: false});
    window.addEventListener('mouseup', stopDrag);
    window.addEventListener('touchend', stopDrag);

    function revealSite() {
        music.muted = false;
        music.volume = 1.0;
        music.currentTime = 0;
        music.play().catch(error => { console.log("Audio retry needed."); });

        handle.style.transform = ""; 
        requestAnimationFrame(() => {
            handle.classList.add('heart-zoom');
            wire.style.opacity = "0";
            const instruction = document.querySelector('.instruction');
            if(instruction) instruction.style.opacity = "0";
        });

        setTimeout(() => {
            darkRoom.style.opacity = "0";
            setTimeout(() => {
                darkRoom.style.display = "none";
                const startPage = document.getElementById('start-page');
                if(startPage) {
                    startPage.classList.add('active');
                    startPage.style.opacity = "1";
                }
            }, 800);
        }, 1000); 
    }

    function nextPage(pageId) {
        if (music.paused) music.play();
        const current = document.querySelector('.panel.active');
        if(!current) return;
        current.style.opacity = '0';
        setTimeout(() => {
            current.classList.remove('active');
            const next = document.getElementById(pageId);
            if(next) {
                next.classList.add('active');
                next.style.opacity = '1';
                const pencil = document.getElementById('pencil-trigger');
                if(pencil) pencil.style.display = (pageId === 'int4') ? 'flex' : 'none';
                if(pageId === 'secret-page') { triggerSecretReveal(); }
            }
        }, 1000);
    }

    function startJourney() {
        if (music.paused) music.play(); // Direct trigger for mobile
         nextPage('int1'); }

    function checkPassword() {
        document.getElementById('password-modal').style.display = 'flex';
        document.getElementById('pass-input').focus();
    }

    function closeModal() {
        document.getElementById('password-modal').style.display = 'none';
        document.getElementById('pass-input').value = '';
    }

    function submitPass() {
        const passInput = document.getElementById('pass-input').value;
        if (passInput === "1234") {
            document.getElementById('password-modal').style.display = 'none';
            nextPage('secret-page');
        } else {
            document.getElementById('password-modal').style.display = 'none';
            document.getElementById('error-modal').style.display = 'flex';
        }
    }

    function closeError() {
        document.getElementById('error-modal').style.display = 'none';
        document.getElementById('password-modal').style.display = 'flex';
    }

    function resetToLamp() {
        const activePanel = document.querySelector('.panel.active');
        if(activePanel) {
            activePanel.classList.remove('active');
            activePanel.style.opacity = '0';
        }
        darkRoom.style.display = "flex";
        setTimeout(() => { darkRoom.style.opacity = "1"; }, 50);
        handle.classList.remove('heart-zoom');
        handle.style.transform = "translateY(0) rotate(-45deg)";
        wire.style.height = "200px";
        wire.style.opacity = "1";
        document.querySelector('.instruction').style.opacity = "1";
        music.pause();
        music.currentTime = 0;
        isSecretMode = false;
    }

    function createParticle() {
            const normalSymbols = ['‚ú®', 'üíñ', 'üåπ', 'ü§ç', '‚ù§Ô∏è‚Äçü©π'];
            const particle = document.createElement('div');
            if (isSecretMode) {
                particle.className = 'petal'; 
                const size = Math.random() * 10 + 10;
                particle.style.width = size + 'px';
                particle.style.height = (size * 1.3) + 'px';
            } else {
                particle.className = 'particle';
                particle.innerHTML = normalSymbols[Math.floor(Math.random() * normalSymbols.length)];
            }
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.animationDuration = isSecretMode ? (Math.random() * 5 + 7) + 's' : (Math.random() * 3 + 4) + 's';
            particleContainer.appendChild(particle);
            setTimeout(() => particle.remove(), isSecretMode ? 11000 : 8000);
        }

    setInterval(createParticle, 400);

    function triggerSecretReveal() {
        isSecretMode = true; 
        if (music) music.volume = 0.4;
        
        const textElement = document.getElementById('secret-letter-text');
        textElement.innerHTML = "";
        
        const restartBtn = document.querySelector('#secret-page button');
        if(restartBtn) restartBtn.style.opacity = "0";

        const royalMessage = "To My Eternal Queen...| You have found the hidden chamber of my heart. | Every star in the sky whispers your name, | and every beat of my heart is a poem written for you. | This is our sanctuary.";
        
        let i = 0;
        function typeWriterWithEmotion() {
            if (i < royalMessage.length) {
                let char = royalMessage.charAt(i);
                if (char === '|') {
                    setTimeout(() => { i++; typeWriterWithEmotion(); }, 800);
                } else {
                    textElement.innerHTML += char;
                    i++;
                    setTimeout(typeWriterWithEmotion, Math.random() * 60 + 40);
                }
            } else {
                // Show Signature and Button
                setTimeout(() => {
                    const sig = document.createElement('div');
                    sig.className = 'signature show';
                    sig.innerHTML = "‚Äî I LOVE YOU FOREVER üíñ ‚Äî";
                    textElement.appendChild(document.createElement('br'));
                    textElement.appendChild(sig);
                    
                    if(restartBtn) {
                        restartBtn.style.transition = "opacity 2s";
                        restartBtn.style.opacity = "1";
                    }
                }, 1000);
            }
        }
        setTimeout(typeWriterWithEmotion, 1500);
    }

    const createStardust = (x, y) => {
        for (let i = 0; i < 10; i++) {
            const dust = document.createElement('div');
            dust.className = 'cursor-sparkle';
            const size = Math.random() * 4 + 1;
            dust.style.width = size + 'px'; dust.style.height = size + 'px';
            dust.style.left = (x + (Math.random() * 20 - 10)) + 'px';
            dust.style.top = (y + (Math.random() * 20 - 10)) + 'px';
            dust.style.setProperty('--drift-x', (Math.random() * 80 - 40) + 'px');
            const duration = Math.random() * 0.5 + 0.8;
            dust.style.animationDuration = duration + 's';
            document.body.appendChild(dust);
            setTimeout(() => dust.remove(), duration * 1000);
        }
    };

    window.addEventListener('mousemove', (e) => createStardust(e.clientX, e.clientY));
    window.addEventListener('touchmove', (e) => createStardust(e.touches[0].clientX, e.touches[0].clientY), { passive: true });

    const spawnHearts = (e) => {
        const x = e.touches ? e.touches[0].clientX : e.clientX;
        const y = e.touches ? e.touches[0].clientY : e.clientY;
        for(let i = 0; i < 6; i++) {
            const heart = document.createElement('div');
            heart.innerHTML = 'ü§ç';
            heart.className = 'click-heart';
            heart.style.left = x + 'px'; heart.style.top = y + 'px';
            heart.style.setProperty('--rand-x', (Math.random() * 60 - 30) + 'px');
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }
    };
    window.addEventListener('mousedown', spawnHearts);
    window.addEventListener('touchstart', spawnHearts, {passive: true});
</script>

    <div id="password-modal">
        <div class="modal-content">
            <h3 class="cursive" style="color: #ff4d4d;">A Secret Awaits...</h3>
            <p style="color: black;">Enter the password, My Queen</p>
            <input type="password" id="pass-input" placeholder="">
            <div class="modal-buttons">
                <button onclick="closeModal()">Cancel</button>
                <button onclick="submitPass()" class="glow-btn">Unlock</button>
            </div>
        </div>
    </div>

    <div id="error-modal">
        <div class="modal-content error-box">
            <h3 class="cursive" style="color: #ff4d4d;">Apologies, My Queen...</h3>
            <p id="error-text">The stars whisper a different password.</p>
            <button onclick="closeError()" class="glow-btn" style="background: #ff4d4d;">Try Again</button>
        </div>
    </div>

</body>
</html>
