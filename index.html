<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Romantic Journey</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=3.0">
    
</head>
<body>

    <div id="dark-room">
        <div id="lamp-container">
            <div id="lamp-wire"></div>
            <div id="lamp-handle" class="glowing-heart"></div>
        </div>
        <p class="instruction">Pull the heart to begin...</p>
    </div>

    <div id="particle-container"></div>

    <audio id="bg-music" loop preload="auto">
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="pencil-trigger" onclick="checkPassword()">üëª</div>

    <section id="start-page" class="panel active start-bg">
        <div class="content-box">
            <h1 class="cursive">Welcome My Queen...</h1>
            <p>Click here to see inside.</p>
            <div class="nav-links">
                <button class="start-btn" onclick="startJourney()">Click</button>
            </div>
        </div>
    </section>

    <section id="int1" class="panel bg-1">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int2')">Next ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int2" class="panel bg-2">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int1')">‚Üê Back</button>
                <button onclick="nextPage('int3')">Continue ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int3" class="panel bg-3">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int2')">‚Üê Back</button>
                <button onclick="nextPage('int4')">Final page ‚Üí</button>
            </div>
        </div>
    </section>

    <section id="int4" class="panel bg-4">
        <div class="content-box">
            <div class="nav-links">
                <button onclick="nextPage('int3')">‚Üê Back</button>
                <button onclick="nextPage('start-page')">Go back to start page</button>
            </div>
        </div>
    </section>

<div id="secret-page" class="panel">
    <div class="content-box">
        <h1 class="cursive" style="margin-top: 0; font-size: 2.5rem; text-shadow: 0 0 10px rgba(255,192,203,0.8);">
            For Your Eyes Only
        </h1>

        <div id="secret-letter-text" class="cursive">
            </div>

        <button onclick="resetToLamp()" class="glow-btn" style="margin-bottom: 0;">
            Back to Start
        </button>
    </div>
</div>

    <script>
const music = document.getElementById('bg-music');
const particleContainer = document.getElementById('particle-container');
const darkRoom = document.getElementById('dark-room');
const handle = document.getElementById('lamp-handle');
const wire = document.getElementById('lamp-wire');

let isDragging = false;
let startY = 0;

// --- UPDATED LAMP THREAD LOGIC ---
const startDrag = (e) => {
    isDragging = true;
    startY = e.touches ? e.touches[0].clientY : e.clientY;

    music.play().then(() => {
        music.pause();
    }).catch(error => {
        console.log("Audio waiting for stronger interaction:", error);
    });
};

const onDrag = (e) => {
    if (!isDragging) return;
    const currentY = e.touches ? e.touches[0].clientY : e.clientY;
    const delta = Math.max(0, currentY - startY);
    if (delta < 250) {
        handle.style.transform = `translateY(${delta}px) rotate(-45deg)`;
        wire.style.height = (200 + delta) + "px";
    }
    if (delta > 160) {
        isDragging = false;
        revealSite();
    }
};

const stopDrag = () => {
    if (!isDragging) return;
    isDragging = false;
    handle.style.transition = "0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
    wire.style.transition = "0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
    handle.style.transform = "translateY(0) rotate(-45deg)";
    wire.style.height = "200px";
};

handle.addEventListener('mousedown', startDrag);
handle.addEventListener('touchstart', startDrag, {passive: false});
window.addEventListener('mousemove', onDrag);
window.addEventListener('touchmove', onDrag, {passive: false});
window.addEventListener('mouseup', stopDrag);
window.addEventListener('touchend', stopDrag);

function revealSite() {
    music.currentTime = 0;
    music.play();
    handle.style.transform = ""; 
    requestAnimationFrame(() => {
        handle.classList.add('heart-zoom');
        wire.style.opacity = "0";
        document.querySelector('.instruction').style.opacity = "0";
    });
    setTimeout(() => {
        darkRoom.style.opacity = "0";
        setTimeout(() => {
            darkRoom.style.display = "none";
            document.getElementById('start-page').classList.add('active');
            document.getElementById('start-page').style.opacity = "1";
        }, 800);
    }, 1000); 
}

// --- NAVIGATION ---
function nextPage(pageId) {
    const current = document.querySelector('.panel.active');
    if(!current) return;

    current.style.opacity = '0';
    setTimeout(() => {
        current.classList.remove('active');
        const next = document.getElementById(pageId);
        if(next) {
            next.classList.add('active');
            next.style.opacity = '1';

            const pencil = document.getElementById('pencil-trigger');
            // Show sparkling heart ONLY on page int4. Hide it on secret-page or others.
            if(pencil) pencil.style.display = (pageId === 'int4') ? 'flex' : 'none';

            // NEW: If entering secret page, start typewriter and change particles
            if(pageId === 'secret-page') {
                triggerSecretReveal();
            }
        }
    }, 1000);
}

function startJourney() { nextPage('int1'); }

// --- BEAUTIFUL CUSTOM MODAL LOGIC ---
function checkPassword() {
    document.getElementById('password-modal').style.display = 'flex';
    document.getElementById('pass-input').focus();
}

function closeModal() {
    document.getElementById('password-modal').style.display = 'none';
    document.getElementById('pass-input').value = '';
}

function submitPass() {
    const input = document.getElementById('pass-input').value;
    if (input === "1234") {
        closeModal();
        isSecretMode = true; // Turn on the petals!
        nextPage('secret-page');
    } else {
        document.getElementById('password-modal').style.display = 'none';
        showError("The stars whisper a different password. Please try again, My Queen.");
        document.getElementById('pass-input').value = '';
    }
}

function typeWriter(text, elementId, speed) {
    let i = 0;
    const elem = document.getElementById(elementId);
    elem.innerHTML = ""; 
    function type() {
        if (i < text.length) {
            elem.innerHTML += text.charAt(i);
            i++;
            setTimeout(type, speed);
        }
    }
    type();
}

function showError(message) {
    document.getElementById('error-text').innerText = message;
    document.getElementById('error-modal').style.display = 'flex';
}

function closeError() {
    document.getElementById('error-modal').style.display = 'none';
    document.getElementById('password-modal').style.display = 'flex';
    document.getElementById('pass-input').focus();
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && document.getElementById('password-modal').style.display === 'flex') {
        submitPass();
    }
});

// --- RESET TO START ---
function resetToLamp() {
    const activePanel = document.querySelector('.panel.active');
    if(activePanel) {
        activePanel.classList.remove('active');
        activePanel.style.opacity = '0';
    }

    darkRoom.style.display = "flex";
    setTimeout(() => {
        darkRoom.style.opacity = "1";
    }, 50);

    handle.classList.remove('heart-zoom');
    handle.style.transform = "translateY(0) rotate(-45deg)";
    wire.style.height = "200px";
    wire.style.opacity = "1";
    document.querySelector('.instruction').style.opacity = "1";
    
    music.pause();
    music.currentTime = 0;
    isSecretMode = false; // Reset particle style
}

// --- PARTICLES ---
let isSecretMode = false; // Global flag for secret page style

function createParticle() {
    const normalSymbols = ['‚ú®', 'üíñ', 'üåπ', 'ü§ç', '‚ù§Ô∏è‚Äçü©π'];
    const secretSymbols = ['üåπ', 'üå∏', 'üå∑', '‚ú®']; 
    
    const symbols = isSecretMode ? secretSymbols : normalSymbols;
    
    const particle = document.createElement('div');
    
    // UPDATE: Apply the specific petal class if in secret mode
    if (isSecretMode) {
        particle.className = 'petal'; 
        particle.innerHTML = ""; // Clear text so the CSS petal shape shows
        
        // Randomize petal size for a natural look
        const size = Math.random() * 10 + 10;
        particle.style.width = size + 'px';
        particle.style.height = (size * 1.3) + 'px';
    } else {
        particle.className = 'particle';
        particle.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
    }

    particle.style.left = Math.random() * 100 + 'vw';
    particle.style.fontSize = (Math.random() * 15 + 12) + 'px';
    
    // Animation duration logic remains the same
    particle.style.animationDuration = isSecretMode ? (Math.random() * 5 + 7) + 's' : (Math.random() * 3 + 4) + 's';
    
    particleContainer.appendChild(particle);
    
    // Increased timeout slightly for the slower falling petals
    setTimeout(() => particle.remove(), isSecretMode ? 11000 : 8000);
}
setInterval(createParticle, 400);

// --- SECRET PAGE IDEAS ---
function triggerSecretReveal() {
    isSecretMode = true; // Change particles to flowers
    
    // Type out the royal message (Make sure you have an ID 'secret-letter-text' in your HTML)
    const royalMessage = "To My Eternal Queen... You have found the hidden chamber of my heart. Every star in the sky whispers your name, and every beat of my heart is a poem written for you. This is our sanctuary.";
    
    // Adding a slight delay so she sees the page transition first
    setTimeout(() => {
        typeWriter(royalMessage, 'secret-letter-text', 70);
    }, 1200);
}

window.addEventListener('mousemove', (e) => {
    const sparkle = document.createElement('div');
    sparkle.className = 'cursor-sparkle';
    sparkle.innerHTML = 'ü¶ã';
    sparkle.style.left = e.clientX + 'px';
    sparkle.style.top = e.clientY + 'px';
    document.body.appendChild(sparkle);
    
    setTimeout(() => sparkle.remove(), 1000);
});

window.addEventListener('touchmove', (e) => {
    const sparkle = document.createElement('div');
    sparkle.className = 'cursor-sparkle';
    sparkle.innerHTML = 'ü¶ã';
    sparkle.style.left = e.touches[0].clientX + 'px';
    sparkle.style.top = e.touches[0].clientY + 'px';
    document.body.appendChild(sparkle);
    
    setTimeout(() => sparkle.remove(), 1000);
});
</script>

<div id="password-modal">
    <div class="modal-content">
        <h3 class="cursive">A Secret Awaits...</h3>
        <p style="color: black;">Enter the password, My Queen</p>
        <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <div class="modal-buttons">
            <button onclick="closeModal()">Cancel</button>
            <button onclick="submitPass()" class="glow-btn">Unlock</button>
        </div>
    </div>
</div>


<div id="error-modal">
    <div class="modal-content error-box">
        <h3 class="cursive" style="color: #ff4d4d;">Apologies, My Queen...</h3>
        <p id="error-text">The stars whisper a different password. Please try again.</p>
        <button onclick="closeError()" class="glow-btn" style="background: #ff4d4d;">Try Again</button>
    </div>
</div>


</body>
</html>

